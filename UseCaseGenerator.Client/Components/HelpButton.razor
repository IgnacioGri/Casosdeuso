@using MudBlazor
@using UseCaseGenerator.Shared.Models

<MudTooltip Text="Ver ayuda para este paso">
    <MudIconButton Icon="@Icons.Material.Filled.Help" 
                   Color="Color.Info" 
                   Size="Size.Small"
                   OnClick="OpenHelp" />
</MudTooltip>

<MudDialog @bind-IsVisible="isHelpOpen" Options="dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Help" Title="Ayuda" Class="mr-2" />
            @GetHelpContent().Title
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudText Typo="Typo.body1" Class="mb-4">
            @GetHelpContent().Description
        </MudText>
        
        <MudText Typo="Typo.subtitle1" Class="mb-2">
            <MudIcon Icon="@Icons.Material.Filled.Checklist" Size="Size.Small" Class="mr-1" />
            Cómo completar este paso:
        </MudText>
        <MudList Dense="true">
            @foreach (var instruction in GetHelpContent().Instructions)
            {
                <MudListItem Icon="@Icons.Material.Filled.ChevronRight" IconSize="Size.Small">
                    @instruction
                </MudListItem>
            }
        </MudList>
        
        @if (GetHelpContent().AiAssistInfo != null)
        {
            <MudDivider Class="my-4" />
            <MudText Typo="Typo.subtitle1" Class="mb-2">
                <MudIcon Icon="@Icons.Material.Filled.SmartToy" Size="Size.Small" Class="mr-1" />
                AI Assist en este paso:
            </MudText>
            <MudAlert Severity="@(GetHelpContent().AiAssistInfo.Available ? Severity.Success : Severity.Info)" 
                      Icon="@(GetHelpContent().AiAssistInfo.Available ? Icons.Material.Filled.CheckCircle : Icons.Material.Filled.Cancel)"
                      Class="mb-2">
                @(GetHelpContent().AiAssistInfo.Available ? "✅ Disponible" : "❌ No disponible")
            </MudAlert>
            <MudText Typo="Typo.body2" Class="mb-2">
                @GetHelpContent().AiAssistInfo.Explanation
            </MudText>
            @if (GetHelpContent().AiAssistInfo.Available && GetHelpContent().AiAssistInfo.Usage.Any())
            {
                <MudText Typo="Typo.subtitle2" Class="mb-1">Cómo usar AI Assist:</MudText>
                <MudList Dense="true">
                    @foreach (var usage in GetHelpContent().AiAssistInfo.Usage)
                    {
                        <MudListItem Icon="@Icons.Material.Filled.ArrowRight" IconSize="Size.Small">
                            @usage
                        </MudListItem>
                    }
                </MudList>
            }
        }
        
        <MudDivider Class="my-4" />
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            <MudIcon Icon="@Icons.Material.Filled.MenuBook" Size="Size.Small" Class="mr-1" />
            <strong>Normas ING:</strong> Todos los pasos siguen la minuta ING vr19 para generar documentación profesional con formato corporativo, numeración multi-nivel y estructura técnica apropiada.
        </MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="CloseHelp" Color="Color.Primary">Cerrar</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter] public int Step { get; set; }
    [Parameter] public UseCaseType? UseCaseType { get; set; }
    
    private bool isHelpOpen = false;
    private DialogOptions dialogOptions = new() { MaxWidth = MaxWidth.Medium, FullWidth = true };
    
    private void OpenHelp() => isHelpOpen = true;
    private void CloseHelp() => isHelpOpen = false;
    
    private class HelpContent
    {
        public string Title { get; set; } = "";
        public string Description { get; set; } = "";
        public List<string> Instructions { get; set; } = new();
        public AiAssistInfo? AiAssistInfo { get; set; }
    }
    
    private class AiAssistInfo
    {
        public bool Available { get; set; }
        public string Explanation { get; set; } = "";
        public List<string> Usage { get; set; } = new();
    }
    
    private HelpContent GetHelpContent()
    {
        return Step switch
        {
            1 => new HelpContent
            {
                Title = "Tipo de Caso de Uso",
                Description = "Selecciona el tipo de caso de uso que deseas generar según las normas ING.",
                Instructions = new List<string>
                {
                    "ENTIDAD: Para casos que gestionan datos (ABM/CRUD)",
                    "API: Para casos que exponen servicios web o integran sistemas externos",
                    "SERVICIO/PROCESO: Para casos que implementan flujos de negocio automáticos",
                    "Cada tipo genera campos específicos en los pasos siguientes",
                    "La elección determina la estructura completa del documento"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "Este paso no tiene AI Assist porque la selección del tipo es una decisión arquitectónica.",
                    Usage = new List<string>()
                }
            },
            
            2 => new HelpContent
            {
                Title = "Análisis Inteligente de Minutas",
                Description = "Carga una minuta de reunión o documento para que la IA extraiga automáticamente la información y complete el formulario.",
                Instructions = new List<string>
                {
                    "Pega el texto de la minuta o documento en el área de texto",
                    "La IA identificará cliente, proyecto, código y requisitos automáticamente",
                    "Puedes cargar un ejemplo completo con el botón 'Cargar Minuta Demo'",
                    "El análisis toma aproximadamente 10-30 segundos",
                    "Todos los campos se completarán basándose en el contenido analizado"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "Este paso usa IA para analizar el documento completo, no requiere AI Assist individual.",
                    Usage = new List<string>()
                }
            },
            
            3 => new HelpContent
            {
                Title = "Información Básica del Proyecto",
                Description = "Completa los datos identificatorios según las normas de documentación ING.",
                Instructions = new List<string>
                {
                    "Nombre del Cliente: Usa el nombre oficial completo (ej: 'Banco Provincia')",
                    "Nombre del Proyecto: Debe ser descriptivo y profesional",
                    "Código del Caso de Uso: Formato recomendado: 2 letras + 3 números (ej: 'UC001', 'BP005')",
                    "Todos los campos son obligatorios para cumplir con la minuta ING",
                    "Los nombres deben ser profesionales y estar en español"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "Estos campos son datos específicos de tu proyecto que debes completar manualmente.",
                    Usage = new List<string>()
                }
            },
            
            4 => new HelpContent
            {
                Title = "Detalles del Caso de Uso",
                Description = "Define el nombre específico y la descripción detallada del caso de uso.",
                Instructions = new List<string>
                {
                    "Nombre del Caso de Uso: Debe empezar con verbo infinitivo (ej: 'Gestionar', 'Crear', 'Consultar')",
                    "Nombre del Archivo: Formato ING obligatorio: 2 letras + 3 números + nombre descriptivo",
                    "Descripción: Explica qué hace el caso de uso, su alcance y objetivo principal",
                    "La descripción debe ser técnica pero comprensible",
                    "Incluye el contexto de negocio y los beneficios esperados"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist está disponible solo para el campo de descripción.",
                    Usage = new List<string>
                    {
                        "Escribe una descripción básica de tu caso de uso",
                        "Presiona el botón AI Assist junto al campo descripción",
                        "El AI mejorará tu texto haciéndolo más profesional y completo",
                        "Seguirá las normas ING de redacción técnica",
                        "Agregará contexto bancario y estructura profesional"
                    }
                }
            },
            
            5 => UseCaseType == Shared.Models.UseCaseType.Entity ? new HelpContent
            {
                Title = "Filtros de Búsqueda",
                Description = "Define los criterios de búsqueda que tendrá tu sistema según las normas ING para interfaces de consulta.",
                Instructions = new List<string>
                {
                    "Los filtros permiten a los usuarios buscar registros específicos",
                    "Incluye filtros básicos: nombre, código, estado, fechas",
                    "Para entidades de personas: DNI, email, teléfono son estándar",
                    "Piensa en los criterios que más usa el negocio para buscar",
                    "Puedes describir en texto libre y usar AI Assist para estructurar"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist convierte texto libre en filtros estructurados automáticamente.",
                    Usage = new List<string>
                    {
                        "Describe en el área superior: 'Los usuarios buscarán por nombre, DNI y estado'",
                        "Presiona el botón AI Assist para convertir automáticamente en filtros individuales",
                        "El AI seguirá estándares bancarios para nombres de filtros",
                        "Generará una lista completa de filtros profesionales y técnicamente correctos",
                        "Luego puedes editar manualmente cada filtro si necesitas ajustes"
                    }
                }
            } : new HelpContent
            {
                Title = "Detalles Técnicos",
                Description = "Define los aspectos técnicos específicos de tu API o servicio.",
                Instructions = new List<string>
                {
                    "Para APIs: Especifica métodos HTTP, endpoints, formatos de datos",
                    "Para Servicios: Define parámetros de entrada, salida y procesamiento",
                    "Incluye detalles de autenticación y autorización",
                    "Describe formatos de respuesta y códigos de error",
                    "Especifica timeouts y límites de procesamiento"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist mejora las descripciones técnicas con terminología profesional.",
                    Usage = new List<string>
                    {
                        "Describe tus requerimientos técnicos en lenguaje simple",
                        "Presiona AI Assist para obtener formato técnico profesional",
                        "El AI agregará especificaciones técnicas estándar",
                        "Aplicará convenciones REST o SOAP según corresponda"
                    }
                }
            },
            
            6 => UseCaseType == Shared.Models.UseCaseType.Entity ? new HelpContent
            {
                Title = "Columnas de Resultado",
                Description = "Define qué información se mostrará en las tablas de resultados según estándares ING de presentación de datos.",
                Instructions = new List<string>
                {
                    "Las columnas muestran la información más relevante de cada registro",
                    "Incluye siempre: código/ID, nombre principal, estado, fecha de alta",
                    "Para personas: nombre completo, DNI, email, teléfono",
                    "Ordena por importancia: datos identificatorios primero",
                    "Máximo 8-10 columnas para no sobrecargar la pantalla"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist estructura las columnas siguiendo mejores prácticas.",
                    Usage = new List<string>
                    {
                        "Describe qué información quieres mostrar en la grilla",
                        "AI Assist generará columnas con nombres técnicos apropiados",
                        "Seguirá convenciones de nomenclatura ING",
                        "Agregará tipos de datos y formatos recomendados"
                    }
                }
            } : new HelpContent
            {
                Title = "Reglas de Negocio",
                Description = "Define las reglas que gobiernan el comportamiento del sistema.",
                Instructions = new List<string>
                {
                    "Especifica validaciones y restricciones del negocio",
                    "Incluye reglas de seguridad y autorización",
                    "Define comportamientos ante casos especiales",
                    "Documenta excepciones y manejo de errores",
                    "Considera normativas y compliance aplicables"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist formaliza las reglas con lenguaje técnico preciso.",
                    Usage = new List<string>
                    {
                        "Describe las reglas en lenguaje natural",
                        "AI Assist las convertirá en formato técnico estructurado",
                        "Agregará numeración y categorización apropiada",
                        "Incluirá consideraciones de seguridad estándar"
                    }
                }
            },
            
            7 => UseCaseType == Shared.Models.UseCaseType.Entity ? new HelpContent
            {
                Title = "Datos de la Entidad",
                Description = "Define los campos y tipos de datos de la entidad que gestionará el caso de uso.",
                Instructions = new List<string>
                {
                    "Incluye todos los campos necesarios para el negocio",
                    "Especifica tipos de datos precisos",
                    "Marca campos obligatorios apropiadamente",
                    "Define longitudes máximas y validaciones",
                    "Considera campos de auditoría (creado por, fecha, etc.)"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist genera definiciones técnicas completas de campos.",
                    Usage = new List<string>
                    {
                        "Lista los campos que necesitas en formato simple",
                        "AI Assist agregará tipos de datos SQL apropiados",
                        "Incluirá validaciones estándar por tipo de campo",
                        "Agregará campos de auditoría recomendados"
                    }
                }
            } : new HelpContent
            {
                Title = "Decisión sobre Casos de Prueba",
                Description = "Decide si deseas incluir casos de prueba en tu documento.",
                Instructions = new List<string>
                {
                    "Selecciona 'Sí' para incluir casos de prueba",
                    "Selecciona 'No' para generar el documento sin pruebas",
                    "Los casos de prueba son recomendados para casos críticos",
                    "Agregan valor y completitud al documento",
                    "Si eliges 'Sí', pasarás al siguiente paso de definición"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "Este es un paso de decisión simple, no requiere AI.",
                    Usage = new List<string>()
                }
            },
            
            8 => UseCaseType == Shared.Models.UseCaseType.Entity ? new HelpContent
            {
                Title = "Opciones Adicionales",
                Description = "Define las reglas de negocio, requerimientos especiales y flujos alternativos.",
                Instructions = new List<string>
                {
                    "Sé específico con las validaciones",
                    "Incluye reglas de seguridad si aplican",
                    "Considera casos especiales y excepciones",
                    "Define flujos alternativos importantes",
                    "Documenta requerimientos no funcionales"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist estructura y formaliza las reglas de negocio.",
                    Usage = new List<string>
                    {
                        "Describe las reglas en lenguaje natural",
                        "AI Assist las formalizará con estructura profesional",
                        "Agregará numeración y categorización",
                        "Incluirá consideraciones técnicas relevantes"
                    }
                }
            } : new HelpContent
            {
                Title = "Generación del Documento",
                Description = "Revisa y genera el documento final.",
                Instructions = new List<string>
                {
                    "Verifica que todos los campos estén completos",
                    "Revisa la coherencia de la información",
                    "El documento seguirá formato ING automáticamente",
                    "Podrás exportar en HTML o DOCX",
                    "Se incluirá tabla de revisiones automáticamente"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "La generación aplica formato sin procesamiento de IA.",
                    Usage = new List<string>()
                }
            },
            
            9 => new HelpContent
            {
                Title = "Decisión sobre Casos de Prueba",
                Description = "Decide si deseas generar casos de prueba para validar el funcionamiento del caso de uso.",
                Instructions = new List<string>
                {
                    "Selecciona 'Sí' para incluir casos de prueba en el documento",
                    "Selecciona 'No' para ir directamente a la generación del documento",
                    "Los casos de prueba agregan valor al documento final",
                    "Recomendado incluirlos para casos de uso críticos",
                    "Si eliges 'Sí', pasarás al paso de definición de casos de prueba"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "Este paso es una decisión simple, no requiere asistencia de IA.",
                    Usage = new List<string>()
                }
            },
            
            10 => new HelpContent
            {
                Title = "Casos de Prueba",
                Description = "Define casos de prueba según especificaciones de la minuta ING para validar el funcionamiento del caso de uso.",
                Instructions = new List<string>
                {
                    "Objetivo: Describe qué se pretende validar con las pruebas",
                    "Precondiciones: Lista los requisitos previos para ejecutar las pruebas",
                    "Pasos de Prueba: Crea una tabla estructurada con cada acción",
                    "Cada paso debe tener: Acción, Datos de entrada, Resultado esperado, Observaciones, Estado P/F",
                    "Usa el botón 'Generar con IA' para crear casos completos automáticamente"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = true,
                    Explanation = "AI Assist genera casos de prueba completos y profesionales automáticamente.",
                    Usage = new List<string>
                    {
                        "Completa objetivo y precondiciones con información básica",
                        "Presiona 'Generar con IA'",
                        "El AI creará múltiples casos de prueba realistas",
                        "Incluirá flujos principales y alternativos",
                        "Agregará datos de prueba específicos del contexto"
                    }
                }
            },
            
            11 => new HelpContent
            {
                Title = "Revisión Final y Generación",
                Description = "Revisa toda la información ingresada y genera el documento de caso de uso final.",
                Instructions = new List<string>
                {
                    "Verifica que todos los campos estén completos y correctos",
                    "Revisa que la información sea coherente y profesional",
                    "El documento seguirá automáticamente el formato de la minuta ING vr19",
                    "Se incluirá numeración multi-nivel, colores corporativos y tipografía Segoe UI",
                    "Puedes exportar en formato HTML (para web) o DOCX (para Word)"
                },
                AiAssistInfo = new AiAssistInfo
                {
                    Available = false,
                    Explanation = "En este paso NO se usa AI. El documento se genera aplicando solo formato y estructura ING sin procesamiento de inteligencia artificial.",
                    Usage = new List<string>()
                }
            },
            
            _ => new HelpContent
            {
                Title = "Ayuda",
                Description = "Información de ayuda no disponible para este paso.",
                Instructions = new List<string>(),
                AiAssistInfo = null
            }
        };
    }
}